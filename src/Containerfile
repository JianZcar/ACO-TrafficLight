
FROM python:3.12-slim

RUN apt-get update && apt-get install -y \
    pypy3 pypy3-dev pypy3-venv wget curl unzip \
    sumo sumo-tools sumo-doc \
    x11vnc xvfb websockify novnc \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

RUN pypy3 -m venv /opt/pypy-venv
ENV PATH="/opt/pypy-venv/bin:$PATH"

RUN pip install --no-cache-dir websockets msgpack sumolib traci

WORKDIR /server
COPY middleware/ /server/
COPY sumo_config/ /server/sumo_config/

EXPOSE 8080 5555

CMD ["/server/start.sh"]

